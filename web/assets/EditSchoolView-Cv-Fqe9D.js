import{_ as I,u as R,R as $,r as g,O as B,P as A,c as x,a as o,w as r,v as i,l as D,e as S,b as y,d as E,f as M,Q as O,g as c,o as b,L as z,p as K,h as T,i as q}from"./index-BKoI7ne0.js";import{l as F}from"./lodash-Diuv5DBq.js";const l=p=>(K("data-v-f47d81d7"),p=p(),T(),p),G={key:0,class:"edit-school"},Q={class:"address-wrapper"},H={class:"address input-wrapper"},J=l(()=>o("label",{for:"address"},"Adresa",-1)),W={class:"coordinates"},X={class:"coordinate input-wrapper"},Y=l(()=>o("label",{for:"xCord"},"Souřadnice x",-1)),Z={class:"coordinate input-wrapper"},ee=l(()=>o("label",{for:"yCord"},"Souřadnice y",-1)),oe={class:"contact"},te={class:"contact-person input-wrapper"},se=l(()=>o("label",{for:"contactPerson"},"Kontaktní email adresa",-1)),ae={class:"website input-wrapper"},le=l(()=>o("label",{for:"website"},'Odkaz na stránku školy (adresa musí obsahovat "https://")',-1)),ne={class:"description input-wrapper"},re=l(()=>o("label",{for:"description"},"Popis školy",-1)),ie={class:"logo-wrapper"},de={class:"logo input-wrapper"},ue=l(()=>o("label",{for:"logo"},"Logo",-1)),ce={key:0},pe={class:"selected-logo"},he=l(()=>o("p",null,"Vybrané logo:",-1)),ve=["src"],me={class:"buttons"},fe=l(()=>o("i",{class:"fa-solid fa-trash-can"},null,-1)),_e=l(()=>o("span",null,"Uložit změny",-1)),we={__name:"EditSchoolView",setup(p){const k=q(),V=R(),n=$(),h=O().params.id,e=g(null),f=g(!1),v=g(!1);let _=!1;async function U(){if(_)return;_=!0;const a=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e.value.address)}`;try{const t=await c.get(a);t.data.length>0&&(e.value.xCord=Number(t.data[0].lat),e.value.yCord=Number(t.data[0].lon))}catch{console.error("Při najímání souřadnic nastala chyba, zkuste znovu zadat adresu školy.");return}_=!1}async function P(a){const t=a.target.files[0];if(!t)return;v.value=!0;const s=new FileReader;return new Promise((m,d)=>{s.onload=async function(u){const j=u.target.result;try{const w=await c.post("/image",{image:j}),C=`${V.apiUrl}/image/${w.data.id}`;e.value.logoLink=C,m(C),v.value=!1}catch(w){alert("Při nahrávání obrázku nastala chyba, zkuste obrázek zmenšit, zkontrolujte připojení k internetu nebo použijte jiný formát souboru."),d(w),v.value=!1}},s.onerror=d,s.readAsDataURL(t)})}async function L(){e.value.xCord=Number(e.value.xCord),e.value.yCord=Number(e.value.yCord);try{if(f.value=!0,h==="new"){const a=await c.post("/school",{school:e.value});n.schools.push(a.data.school),window.location.href=`/admin/school/${a.data.school.id}`}else await c.put(`/school/${e.value.id}`,{school:e.value}),n.schools=n.schools.map(a=>a.id===e.value.id?e.value:a)}catch(a){console.error(a)}f.value=!1}B(()=>n.schools,(a,t)=>{if(h==="new"){if(e.value)return;e.value={name:"",address:"",contactPerson:"",website:"",description:"",logoLink:"",xCord:"",yCord:""};return}const s=n.schools.find(m=>m.id===h);if(n.schools.length!==0&&!s){k.push({name:"admin-schools"});return}e.value=s?F.cloneDeep(s):null},{immediate:!0}),A((a,t,s)=>{(()=>{if(e.value.xCord=Number(e.value.xCord),e.value.yCord=Number(e.value.yCord),h==="new")return!0;const d=n.schools.find(u=>u.id===e.value.id);return d?["name","address","xCord","yCord","contactPerson","website","description","logoLink"].some(u=>d[u]!==e.value[u]):!1})()?window.confirm("Máte neuložené změny, opravdu chcete tuto stránku opustit?")?s():s(!1):s()});async function N(){if(window.confirm("Opravdu chcete smazat tuto školu?"))try{await c.delete(`/school/${e.value.id}`),n.schools=n.schools.filter(t=>t.id!==e.value.id),k.push({name:"admin-schools"})}catch(t){console.error(t),alert("Při mazání školy nastala chyba, zkuste to znovu.")}}return(a,t)=>e.value?(b(),x("div",G,[o("form",{onSubmit:t[7]||(t[7]=M(()=>{},["prevent"]))},[r(o("input",{class:"title","onUpdate:modelValue":t[0]||(t[0]=s=>e.value.name=s),type:"text",placeholder:"Název školy"},null,512),[[i,e.value.name]]),o("div",Q,[o("div",H,[J,r(o("input",{id:"address",type:"text","onUpdate:modelValue":t[1]||(t[1]=s=>e.value.address=s),placeholder:"Adresa",onInput:U},null,544),[[i,e.value.address]])]),o("div",W,[o("div",X,[Y,r(o("input",{id:"xCord",type:"text","onUpdate:modelValue":t[2]||(t[2]=s=>e.value.xCord=s),placeholder:"Souřadnice x"},null,512),[[i,e.value.xCord]])]),o("div",Z,[ee,r(o("input",{id:"yCord",type:"text","onUpdate:modelValue":t[3]||(t[3]=s=>e.value.yCord=s),placeholder:"Souřadnice y"},null,512),[[i,e.value.yCord]])])])]),o("div",oe,[o("div",te,[se,r(o("input",{id:"contactPerson",type:"text","onUpdate:modelValue":t[4]||(t[4]=s=>e.value.contactPerson=s),placeholder:"Kontaktní osoba"},null,512),[[i,e.value.contactPerson]])]),o("div",ae,[le,r(o("input",{id:"website",type:"text","onUpdate:modelValue":t[5]||(t[5]=s=>e.value.website=s),placeholder:"https://www.example.com"},null,512),[[i,e.value.website]])])]),o("div",ne,[re,r(o("textarea",{id:"description","onUpdate:modelValue":t[6]||(t[6]=s=>e.value.description=s),placeholder:"Popis školy"},null,512),[[i,e.value.description]])]),o("div",ie,[o("div",de,[ue,o("input",{id:"logo",type:"file",onChange:P,placeholder:"Logo",accept:"image/png, image/jpeg, image/jpg, image/webp, image/svg+xml"},null,32),v.value?(b(),x("p",ce,[D(z),S(" Logo se nahrává ")])):y("",!0)]),o("div",pe,[he,o("img",{src:e.value.logoLink,alt:"Logo"},null,8,ve)])]),o("div",me,[o("button",{onClick:N,class:"delete"},[S(" Smazat školu "),fe]),o("button",{type:"submit",onClick:L},[f.value?(b(),E(z,{key:0,class:""})):y("",!0),_e])])],32)])):y("",!0)}},ke=I(we,[["__scopeId","data-v-f47d81d7"]]);export{ke as default};
